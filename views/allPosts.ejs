<%- include ("./partials/header") %>

<div class="container my-5 py-3" style="background-color: white;">
  <div class="row justify-content-around">
    <div class="col-sm-8">
      <h2 style="text-align: center;">All Posts</h2>

      <hr>

      <!-- pagination -->
      <div style="margin: 20px 0;">
        <% if(postPagination.page - 1) { %>
          <a href="<%= paginateUrl %><%= postPagination.page - 1 %>">Prev</a>
        <% } %>
        <% if (postPagination.pages > 1) { %>
        <% for(let i = 1; i <= postPagination.pages; i++) { %>
          <a href="<%= paginateUrl %><%= i %>"
            <%= i === postPagination.page ? 'style=color:#000;' : '' %>
            ><%= i %></a>
        <% } %>
        <% } %>
        <% if((postPagination.page + 1) <= postPagination.pages) { %>
          <a href="<%= paginateUrl %><%= postPagination.page + 1 %>">Next</a>
        <% } %>
      </div>

      <% posts.forEach(post => { %>
        <hr>
        <div>
          <h4><a href="/<%= post.author %>/blog/post/<%= post.id %>"><%= post.title %></a></h4>
          <h6><i><a href="/<%= post.author %>/profile"><%= post.author %></a> posted at: <span class="time"><%= post.created_at %></span></i></h6>
          <p><%- post.content.replace(/<[^>]*?>/g, ' ').replace(/\s{2,}/g, ' ').trim().slice(0, 300) %>...</p>
          <h6>(<a href="/<%= post.author %>/blog/post/<%= post.id %>">Read More</a>)</h6>
        </div>
      <% }); %>

      <script>
        let timeLabel = document.querySelectorAll(".time");
        for (let t of timeLabel) {
          let time = new Date(t.innerHTML);
          t.innerHTML = time.toLocaleString('en-US');
        }
      </script>

      <!-- pagination -->
      <div style="margin: 20px 0;">
        <% if(postPagination.page - 1) { %>
          <a href="<%= paginateUrl %><%= postPagination.page - 1 %>">Prev</a>
        <% } %>
        <% if (postPagination.pages > 1) { %>
        <% for(let i = 1; i <= postPagination.pages; i++) { %>
          <a href="<%= paginateUrl %><%= i %>"
            <%= i === postPagination.page ? 'style=color:#000;' : '' %>
            ><%= i %></a>
        <% } %>
        <% } %>
        <% if((postPagination.page + 1) <= postPagination.pages) { %>
          <a href="<%= paginateUrl %><%= postPagination.page + 1 %>">Next</a>
        <% } %>
      </div>
    </div>
  </div>
</div>

<%- include ("./partials/footer") %>