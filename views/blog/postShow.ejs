<%- include ("../partials/header") %>

<div class="container-fluid">
  <div class="row justify-content-around">
    <div class="col-sm-8">
      <h2 style="text-align: center;"><a href="/<%= owner %>/blog"><%= owner %>'s Blog</a></h2>

      <hr>

      <div><h1><%= post.title %></h1></div>
      <div><h6>Posted at: <%= post.created_at.toLocaleDateString() %>, <%= post.created_at.toLocaleTimeString() %></h6></div>
      <div><h6>Views: <%= post.totalVisits %></h6></div>

      <hr>

      <div><%- post.content %></div>

      <% if(user === owner) { %> 
        <div class="container text-center">
          <a class="btn btn-primary" href="/<%= owner %>/blog/post/<%= post.id %>/edit">Edit</a>
          <form style="display: inline;" action="/<%= owner %>/blog/post/<%= post.id %>/?_method=DELETE" method="POST">
            <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteModal">Delete</button>
            <!-- Modal -->
            <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Warning</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    Are you sure you want to delete this post?
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Yes</button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      <% } %>

      <% if(comments.length) { %>
        <% comments.forEach((comment) => { %>
          <hr>
          <div>
            <h6><b><%= comment.author %>:</b></h6>
            <h6><i>Commented at: <%= comment.created_at.toLocaleDateString() %>, <%= comment.created_at.toLocaleTimeString() %></i></h6>
            <p><%= comment.content %></p>
            <% if(user === comment.author) { %>
              <form id="commentEditForm" style="display: none;" action="/<%= owner %>/blog/post/<%= post.id %>/comment/<%= comment.id %>/?_method=PUT" method="POST">
                <div class="form-group col-md-8 mx-auto">
                  <textarea class="form-control" name="comment[content]" placeholder="Content" rows="5" required><%= comment.content %></textarea>
                </div>
                <div class="form-group row justify-content-center">
                  <button type="submit" class="btn btn-sm btn-success mx-1">Submit</button>
                  <button type="button" id="cancelBtn" class="btn btn-sm btn-secondary mx-1">Cancel</button>
                </div>
              </form>
              <div class="form-group row justify-content-center">
                <button class="btn btn-sm btn-primary mx-1" id="commentEditBtn">Edit</button>
                <form action="/<%= owner %>/blog/post/<%= post.id %>/comment/<%= comment.id %>/?_method=DELETE" method="POST">
                  <button type="submit" id="commentDeleteBtn" class="btn btn-sm btn-danger mx-1">Delete</button>
                </form>
              </div>
            <% } %>
          </div>
        <% }); %> 
      <% } %> 

      <% if(user) { %> 
        <hr>
          <form class="form-row" action="<%= post.id %>/comment" method="POST">
            <div class="form-group col-md-8 mx-auto">
              <textarea class="form-control" name="comment[content]" placeholder="Leave your comment..." rows="5" required></textarea>
            </div>
            <div class="form-group mx-auto align-self-center">
              <input type="submit" class="btn btn-success" value="Submit">
            </div>
          </form>
        
      <% } else { %> 
        <hr>
          <h5>Please login or register to leave a comment!</h5>
      <% } %>
    </div>

    <div class="col-sm-3">
      <div class="d-flex flex-column align-items-center">
        <h5>About me:</h5>
        <a href="/<%= owner %>/profile">
          <img src="<%= avatar %>" alt="avatar" style="height: 150px; width: 150px; overflow: hidden;">
        </a>
        <p style="font-size: 1.5rem;"><a href="/<%= owner %>/profile"><%= owner %></a></p>
                
        <h5>tags:</h5>
        <% tagList.forEach(tag => { %>
          <a href="/<%= owner %>/blog/tag/<%= tag[0] %>"><%= tag[0] %>(<%= tag[1] %>)</a>
        <% }); %> 
      </div>
    </div>
  </div>
</div>

<script src="/javascript/blog/postShow.js"></script>

<%- include ("../partials/footer") %>
